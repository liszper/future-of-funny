shadow$provide.module$node_modules$engine_DOT_io_client$build$cjs$transports$websocket=function(global,require,module,exports){var Buffer=require("module$node_modules$buffer$index").Buffer;"use strict";module=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{"default":mod}};Object.defineProperty(exports,"__esModule",{value:!0});exports.WS=void 0;global=require("module$node_modules$engine_DOT_io_client$build$cjs$transport");const parseqs_js_1=require("module$node_modules$engine_DOT_io_client$build$cjs$contrib$parseqs"),
yeast_js_1=require("module$node_modules$engine_DOT_io_client$build$cjs$contrib$yeast"),util_js_1=require("module$node_modules$engine_DOT_io_client$build$cjs$util"),websocket_constructor_js_1=require("module$node_modules$engine_DOT_io_client$build$cjs$transports$websocket_constructor_browser");module=module(require("module$node_modules$engine_DOT_io_client$node_modules$debug$src$browser"));const engine_io_parser_1=require("module$node_modules$engine_DOT_io_parser$build$cjs$index"),debug=(0,module.default)("engine.io-client:websocket"),
isReactNative="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class WS extends global.Transport{constructor(opts){super(opts);this.supportsBinary=!opts.forceBase64}get name(){return"websocket"}doOpen(){if(this.check()){var uri=this.uri(),protocols=this.opts.protocols,opts=isReactNative?{}:(0,util_js_1.pick)(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion",
"origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(opts.headers=this.opts.extraHeaders);try{this.ws=websocket_constructor_js_1.usingBrowserWebSocket&&!isReactNative?protocols?new websocket_constructor_js_1.WebSocket(uri,protocols):new websocket_constructor_js_1.WebSocket(uri):new websocket_constructor_js_1.WebSocket(uri,protocols,opts)}catch(err){return this.emitReserved("error",err)}this.ws.binaryType=this.socket.binaryType||websocket_constructor_js_1.defaultBinaryType;
this.addEventListeners()}}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref();this.onOpen()};this.ws.onclose=closeEvent=>this.onClose({description:"websocket connection closed",context:closeEvent});this.ws.onmessage=ev=>this.onData(ev.data);this.ws.onerror=e=>this.onError("websocket error",e)}write(packets){this.writable=!1;for(let i=0;i<packets.length;i++){const packet=packets[i],lastPacket=i===packets.length-1;(0,engine_io_parser_1.encodePacket)(packet,this.supportsBinary,
data=>{const opts={};websocket_constructor_js_1.usingBrowserWebSocket||(packet.options&&(opts.compress=packet.options.compress),this.opts.perMessageDeflate&&("string"===typeof data?Buffer.byteLength(data):data.length)<this.opts.perMessageDeflate.threshold&&(opts.compress=!1));try{websocket_constructor_js_1.usingBrowserWebSocket?this.ws.send(data):this.ws.send(data,opts)}catch(e){debug("websocket closed before onclose event")}lastPacket&&(0,websocket_constructor_js_1.nextTick)(()=>{this.writable=!0;
this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){"undefined"!==typeof this.ws&&(this.ws.close(),this.ws=null)}uri(){var query=this.query||{};const schema=this.opts.secure?"wss":"ws";let port="";this.opts.port&&("wss"===schema&&443!==Number(this.opts.port)||"ws"===schema&&80!==Number(this.opts.port))&&(port=":"+this.opts.port);this.opts.timestampRequests&&(query[this.opts.timestampParam]=(0,yeast_js_1.yeast)());this.supportsBinary||(query.b64=1);query=(0,parseqs_js_1.encode)(query);const ipv6=
-1!==this.opts.hostname.indexOf(":");return schema+"://"+(ipv6?"["+this.opts.hostname+"]":this.opts.hostname)+port+this.opts.path+(query.length?"?"+query:"")}check(){return!!websocket_constructor_js_1.WebSocket}}exports.WS=WS}
//# sourceMappingURL=module$node_modules$engine_DOT_io_client$build$cjs$transports$websocket.js.map
